<!doctype html>
<html>
<head>
    <title>labeling</title>
</head>

<body>
<h1>Data labeler</h1>

<p>upload zip file with images</p>
<form method="post" action="/upload">
    <input name="file" type="file" size="150">
    <button type="submit" style="font-size: 25px;">UPLOAD</button>
</form>
<br>

<canvas id="canvas" style="border:3px solid #d3d3d3;">
</canvas>
<p>
<button id="add" style="font-size: 22px;">ADD</button>
<select id="selected_label" name="selected_label">
    <option value="0">dictators</option>
    <option value="1">label2</option>
    <option value="2">label3</option>
</select>
<button id="add_label" onclick="add_label()">+Label</button>
</p>

<script>
    var canvas = document.getElementById("canvas");
    canvas.height= window.innerHeight/1.5;
    canvas.width= window.innerWidth/1.5;
    var ctx = canvas.getContext("2d");
    var rect = {};
    var yolo_data= {
        "label_index": -1,
        "start_x": 0,
        "start_y": 0,
        "width": 0,
        "height": 0
    }
    var drag = false;
    var image = null;

    var add_button= document.getElementById("add");
    add_button.addEventListener("click", getYolo);

    function init() {
        image = new Image();
        image.onload = function () {
            ctx.drawImage(image, 0, 0);
        };
        image.src = "./fish.jpg"

        canvas.addEventListener('mousedown', mouseDown, false);
        canvas.addEventListener('mouseup', mouseUp, false);
        canvas.addEventListener('mousemove', mouseMove, false);
    }

    function mouseDown(e) {
        rect.startX = e.pageX - this.offsetLeft;
        rect.startY = e.pageY - this.offsetTop;
        drag = true;
    }

    function mouseUp() {
        drag = false;
    }

    function mouseMove(e){
        if(!drag) return 0;
        ctx.clearRect(0,0, canvas.width, canvas.height);
        ctx.drawImage(image, 0,0);
        rect.w = (e.pageX - this.offsetLeft) - rect.startX;
        rect.h = (e.pageY - this.offsetTop) - rect.startY;
        ctx.strokeStyle = 'red';
        ctx.lineWidth= 10;
        ctx.strokeRect(rect.startX, rect.startY, rect.w, rect.h);
    }

    function getYolo(){
        var x_start= rect.startX/image.width;
        var y_start= rect.startY/image.height;
        var width= Math.abs(rect.w/image.width);
        var height= Math.abs(rect.h/image.height);
        yolo_data["start_x"]= x_start;
        yolo_data["start_y"]= y_start;
        yolo_data["width"]= width;
        yolo_data["height"]= height;

        var optionList= document.getElementById("selected_label");
        yolo_data["label_index"]= optionList.value;


    }

    function add_label(){
        var option= document.createElement("option");
        option.value= "4";
        option.text= "new label";
        var list= document.getElementById("selected_label");
        list.add(option, null);
    }
    init();

</script>

</body>
</html>

